<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servidor Melvin</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        h1 { font-size: 25pt; text-shadow: 1px 1px 1px black; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 30px; }
        .painel {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            width: 250px;
            min-height: 150px;
            border: 1px solid #333;
        }
        h3 { margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .info { font-size: 16pt; margin: 10px 0; font-weight: bold; }
        .logout-btn { color: red; font-weight: bold; text-decoration: none; display: block; margin-bottom: 20px; }
    </style>
</head>
<body>
    <a href="/gerenciar-arquivos" class="btn btn-info">Acessar Arquivos do SSD</a>	
    <a href="/logout" class="logout-btn">SAIR DO SISTEMA</a>

    <h1>Dados do Servidor Ubuntu! üåç</h1>

    <div class="container" id="interface">
        <div class="painel">
            <h3>üíª PROCESSADOR</h3>
            <p class="info" style="color: #00ff00;">Uso: <span id="cpuUso">...</span></p>
            <p class="info" style="color: #ff4444;">Temp: <span id="cpuTemp">...</span></p>
        </div>

        <div class="painel">
            <h3>üß† MEM√ìRIA RAM</h3>
            <p class="info">Usada: <span id="ramUsada">...</span></p>
            <p class="info" style="color: #00ff00;">Livre: <span id="ramLivre">...</span></p>
        </div>

        <div class="painel">
            <h3>üíæ ARMAZENAMENTO</h3>
            <p class="info" style="color: #00ff00;">Usado: <span id="ssdUsado">...</span></p>
            <p class="info" style="color: #00d4ff;">Livre: <span id="ssdLivre">...</span></p>
        </div>

        <div class="painel">
            <h3>üîå DISCO (SDA1)</h3>
            <p class="info" style="color: #00ff00;">Usado: <span id="sda1Usado">...</span></p>
            <p class="info" style="color: #ffa500;">Livre: <span id="sda1Livre">...</span></p>
        </div>

        <div class="painel">
            <h3>üóÑÔ∏è MYSQL</h3>
            <p class="info" style="color: #f39c12;">Base: <span id="mysqlSize">...</span></p>
            <p class="info" style="color: #00ff00;">Status: Online</p>
        </div>
	<div class="painel">
    	<h3>üå°Ô∏è SENSOR EXTERNO</h3>
    	<p class="info" style="color: #00d4ff;">Valor: <span id="sensorValor">...</span></p>
    	<p class="info" style="font-size: 10pt; color: #888;">√öltima atualiza√ß√£o: <span id="sensorData">...</span></p>
	</div>
    </div>

	<script>
    function atualizarDashboard() {
        // O timestamp ?t= impede que o navegador use dados "velhos" do cache
        fetch('/api/stats?t=' + new Date().getTime())
            .then(response => {
                if (!response.ok) throw new Error("Erro na rede ou sess√£o expirada");
                return response.json();
            })
            .then(data => {
                // Se o backend retornar null (n√£o logado), os valores n√£o atualizam
                if (!data) return;

                // Atualiza os elementos da tela
                document.getElementById('cpuUso').innerText = data.cpuUso || '---';
                document.getElementById('cpuTemp').innerText = data.cpuTemp || '---';
                document.getElementById('ramUsada').innerText = data.ramUsada || '---';
                document.getElementById('ramLivre').innerText = data.ramLivre || '---';
                document.getElementById('ssdUsado').innerText = data.ssdUsado || '---';
                document.getElementById('ssdLivre').innerText = data.ssdLivre || '---';
                document.getElementById('sda1Usado').innerText = data.sda1Usado || '---';
                document.getElementById('sda1Livre').innerText = data.sda1Livre || '---';
                document.getElementById('mysqlSize').innerText = data.mysqlSize || '0.00 MB';
                
                // Sensor Externo
                document.getElementById('sensorValor').innerText = data.sensorValor || 'N/A';
                document.getElementById('sensorData').innerText = data.sensorData || new Date().toLocaleTimeString();
            })
            .catch(error => console.error('Erro na leitura da API:', error));
    }
        // Inicia imediatamente ao carregar a p√°gina
        atualizarDashboard();
        
        // Repete a cada 5 segundos sem recarregar a p√°gina
        setInterval(atualizarDashboard, 5000);
    </script>

    <footer style="margin-top: 50px;">
        <p>Copyright &copy; 2025 - Melvin Satiro</p>
    </footer>
</body>
</html>
